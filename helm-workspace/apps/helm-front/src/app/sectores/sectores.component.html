<div class="layout-container">
  <app-menu class="menu-lateral"></app-menu>

  <div class="contenido-principal">

    <div class="header">
      <h1>Sectores</h1>

      <div class="flex">
        <input type="text" placeholder="Buscar sector por descripción..." class="buscador"
          [formControl]="filtroDescripcion">
        <button (click)="mostrarFormularioCrear = true" id="boton">Crear sector</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>description</th>
          <th>textoweb</th>
          <th>prefijo</th>
          <th>slug</th>
          <th>descriptionweb</th>
          <th>titleweb</th>
          <th>background</th>
          <th class="text-center">Editar</th>
          <th class="text-center">Eliminar</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let sector of sectoresFiltrados; trackBy: trackBySectorId">
          <td>{{sector.description}}</td>
          <td>{{sector.textoweb}}</td>
          <td>{{sector.prefijo}}</td>
          <td>{{sector.slug}}</td>
          <td>{{sector.descriptionweb}}</td>
          <td>{{sector.titleweb}}</td>
          <td class="background-image-cell">{{sector.backgroundImage}}</td>
          <td class="text-center">
            <button class="btn" (click)="mostrarFormularioEditarSector(sector)" title="Modificar sector">
              <img src="assets/pencil.png" alt="lápiz" width="25px" height="25px">
            </button>
          </td>
          <td class="text-center">
            <button class="btn" (click)="confirmarEliminarSector(sector.id_sector!, $event)" title="Eliminar sector">
              <img src="assets/papelera.png" alt="papelera" width="25px" height="25px">
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="no-data-message" *ngIf="sectoresFiltrados.length === 0">
      No se encontraron sectores disponibles.
    </div>

    <div *ngIf="mostrarFormularioCrear" class="form-crear">
      <h3>Crear nuevo sector</h3>

      <form (ngSubmit)="crearSector()" class="formulario-sector">
        <div class="campo-formulario">
          <label for="description">Descripción:</label>
          <input type="text" id="description" [(ngModel)]="nuevoSector.description" name="description" required
            placeholder="Introduce una descripción" />
        </div>

        <div class="campo-formulario">
          <label for="textoweb">Texto Web:</label>
          <input type="text" id="textoweb" [(ngModel)]="nuevoSector.textoweb" name="textoweb" required
            placeholder="Introduce el texto web" />
        </div>

        <div class="campo-formulario">
          <label for="prefijo">Prefijo:</label>
          <input type="text" id="prefijo" [(ngModel)]="nuevoSector.prefijo" name="prefijo" required
            placeholder="Introduce el prefijo" />
        </div>

        <div class="campo-formulario">
          <label for="slug">Slug:</label>
          <input type="text" id="slug" [(ngModel)]="nuevoSector.slug" name="slug" required
            placeholder="Introduce el slug" />
        </div>

        <div class="campo-formulario">
          <label for="descriptionweb">Descripción Web:</label>
          <input type="text" id="descriptionweb" [(ngModel)]="nuevoSector.descriptionweb" name="descriptionweb"
            placeholder="Introduce la descripción web" />
        </div>

        <div class="campo-formulario">
          <label for="titleweb">Título Web:</label>
          <input type="text" id="titleweb" [(ngModel)]="nuevoSector.titleweb" name="titleweb"
            placeholder="Introduce el título web" />
        </div>

        <div class="campo-formulario">
          <label for="backgroundImage">Imagen de fondo (URL):</label>
          <input type="text" id="backgroundImage" [(ngModel)]="nuevoSector.backgroundImage" name="backgroundImage"
            placeholder="Introduce la URL de la imagen de fondo" />
        </div>

        <div class="botones-formulario">
          <button type="submit" class="btn-submit">Crear</button>
          <button type="button" class="btn-cancelar" (click)="mostrarFormularioCrear = false">Cancelar</button>
        </div>
      </form>
    </div>

    <div *ngIf="mostrarFormularioEditar" class="form-crear">
      <h3>Modificar sector</h3>

      <form (ngSubmit)="guardarCambiosSector()" class="formulario-sector">
        <div class="campo-formulario">
          <label for="description">Descripción:</label>
          <input type="text" id="description" [(ngModel)]="sectorAEditar!.description" name="edit_description"
            required />
        </div>

        <div class="campo-formulario">
          <label for="textoweb">Texto Web:</label>
          <input type="text" id="textoweb" [(ngModel)]="sectorAEditar!.textoweb" name="edit_textoweb" required />
        </div>

        <div class="campo-formulario">
          <label for="prefijo">Prefijo:</label>
          <input type="text" id="prefijo" [(ngModel)]="sectorAEditar!.prefijo" name="edit_prefijo" required />
        </div>

        <div class="campo-formulario">
          <label for="slug">Slug:</label>
          <input type="text" id="slug" [(ngModel)]="sectorAEditar!.slug" name="edit_slug" required />
        </div>

        <div class="campo-formulario">
          <label for="descriptionweb">Descripción Web:</label>
          <input type="text" id="descriptionweb" [(ngModel)]="sectorAEditar!.descriptionweb"
            name="edit_descriptionweb" />
        </div>

        <div class="campo-formulario">
          <label for="titleweb">Título Web:</label>
          <input type="text" id="titleweb" [(ngModel)]="sectorAEditar!.titleweb" name="edit_titleweb" />
        </div>

        <div class="campo-formulario">
          <label for="backgroundImage">Imagen de fondo (URL):</label>
          <input type="text" id="backgroundImage" [(ngModel)]="sectorAEditar!.backgroundImage"
            name="edit_backgroundImage" />
        </div>

        <div class="botones-formulario">
          <button type="submit" class="btn-submit">Guardar cambios</button>
          <button type="button" class="btn-cancelar" (click)="mostrarFormularioEditar = false">Cancelar</button>
        </div>
      </form>
    </div>

  </div>
</div>

<!-- Modal de confirmación para eliminar sector -->
<div class="modal-overlay" *ngIf="mostrarModal">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Confirmar eliminación</h2>
    </div>
    <div class="modal-body">
      <p>¿Está seguro de que desea eliminar este sector?</p>
      <p class="warning-text">Esta acción no se puede deshacer.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cancelarEliminarSector()">Cancelar</button>
      <button class="btn-eliminar" (click)="eliminarSector()">Eliminar</button>
    </div>
  </div>
</div>