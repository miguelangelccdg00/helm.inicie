<!-- Contenedor principal con el menú lateral y el contenido -->
<div class="layout-container">
  <app-menu class="menu-lateral"></app-menu>

  <div class="contenido-principal">

    <!-- Encabezado de la vista con título y buscador -->
    <div class="header">
      <h1>Ámbitos</h1>

      <div class="flex">
        <!-- Input con filtro reactivo por descripción -->
        <input type="text" placeholder="Buscar ámbito por descripción..." class="buscador"
          [formControl]="filtroDescripcion">
        
        <!-- Botón para mostrar formulario de creación -->
        <button (click)="mostrarFormularioCrear = true; mostrarFormularioEditar = false; scrollCrear()" id="boton">
          Crear ámbito
        </button>
      </div>
    </div>

    <!-- Tabla con los ámbitos listados -->
    <table>
      <thead>
        <tr>
          <th>description</th>
          <th>textoweb</th>
          <th>prefijo</th>
          <th>slug</th>
          <th class="text-center">Editar</th>
          <th class="text-center">Eliminar</th>
        </tr>
      </thead>
      <tbody>
        <!-- Iteración sobre ámbitos filtrados -->
        <tr *ngFor="let ambito of ambitosFiltrados; trackBy: trackByAmbitoId">
          <td>{{ambito.description}}</td>
          <td>{{ambito.textoweb}}</td>
          <td>{{ambito.prefijo}}</td>
          <td>{{ambito.slug}}</td>
          <td class="text-center">
            <!-- Botón para mostrar formulario de edición -->
            <button class="btn" (click)="mostrarFormularioEditarAmbito(ambito)" title="Modificar ámbito">
              <img src="assets/pencil.png" alt="lápiz" width="25px" height="25px">
            </button>
          </td>
          <td class="text-center">
            <!-- Botón para confirmar eliminación -->
            <button class="btn" (click)="confirmarEliminarAmbito(ambito.id_ambito!, $event)" title="Eliminar ámbito">
              <img src="assets/papelera.png" alt="papelera" width="25px" height="25px">
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Mensaje cuando no hay resultados -->
    <div class="no-data-message" *ngIf="ambitosFiltrados.length === 0">
      No se encontraron ámbitos disponibles.
    </div>

    <!-- Formulario de creación de ámbito -->
    <div *ngIf="mostrarFormularioCrear" class="form-crear" #crearForm>
      <h3>Crear nuevo ámbito</h3>
      <form #form="ngForm" (ngSubmit)="crearAmbito()" class="formulario-ambito">
        <!-- Campo descripción -->
        <div class="campo-formulario">
          <label for="description">Descripción:</label>
          <input type="text" id="description" [(ngModel)]="nuevoAmbito.description" name="description"
            required placeholder="Introduce una descripción" #descripcion="ngModel" />
          <div class="error" *ngIf="descripcion.invalid && descripcion.touched">
            La descripción es obligatoria.
          </div>
        </div>
      
        <!-- Campo texto web -->
        <div class="campo-formulario">
          <label for="textoweb">Texto Web:</label>
          <input type="text" id="textoweb" [(ngModel)]="nuevoAmbito.textoweb" name="textoweb"
            required placeholder="Introduce el texto web" #textoweb="ngModel" />
          <div class="error" *ngIf="textoweb.invalid && textoweb.touched">
            El texto web es obligatorio.
          </div>
        </div>
      
        <!-- Campo prefijo -->
        <div class="campo-formulario">
          <label for="prefijo">Prefijo:</label>
          <input type="text" id="prefijo" [(ngModel)]="nuevoAmbito.prefijo" name="prefijo"
            required placeholder="Introduce el prefijo" #prefijo="ngModel" />
          <div class="error" *ngIf="prefijo.invalid && prefijo.touched">
            El prefijo es obligatorio.
          </div>
        </div>
      
        <!-- Campo slug -->
        <div class="campo-formulario">
          <label for="slug">Slug:</label>
          <input type="text" id="slug" [(ngModel)]="nuevoAmbito.slug" name="slug"
            required placeholder="Introduce el slug" #slug="ngModel" />
          <div class="error" *ngIf="slug.invalid && slug.touched">
            El slug es obligatorio.
          </div>
        </div>
      
        <!-- Botones -->
        <div class="botones-formulario">
          <button type="submit" class="btn-submit" [disabled]="form.invalid">Crear</button>
          <button type="button" class="btn-cancelar" (click)="mostrarFormularioCrear = false">Cancelar</button>
        </div>
      </form>
      
    </div>

    <!-- Formulario de edición de ámbito -->
    <div *ngIf="mostrarFormularioEditar" class="form-crear" #editarForm>
      <h3>Modificar ámbito</h3>
      <form #formEditar="ngForm" (ngSubmit)="guardarCambiosAmbito()" class="formulario-ambito">
        <!-- Campo: Descripción -->
        <div class="campo-formulario">
          <label for="description">Descripción:</label>
          <input type="text" id="description" [(ngModel)]="ambitoAEditar!.description" name="edit_description" required placeholder="Introduce una descripción" #edit_description="ngModel"/>
          <div *ngIf="edit_description.invalid && edit_description.touched" class="error">
            La descripción es obligatoria.
          </div>
        </div>
      
        <!-- Campo: Texto Web -->
        <div class="campo-formulario">
          <label for="textoweb">Texto Web:</label>
          <input type="text" id="textoweb" [(ngModel)]="ambitoAEditar!.textoweb" name="edit_textoweb" required placeholder="Introduce el texto web" #edit_textoweb="ngModel"/>
          <div *ngIf="edit_textoweb.invalid && edit_textoweb.touched" class="error">
            El texto web es obligatorio.
          </div>
        </div>
      
        <!-- Campo: Prefijo -->
        <div class="campo-formulario">
          <label for="prefijo">Prefijo:</label>
          <input type="text" id="prefijo" [(ngModel)]="ambitoAEditar!.prefijo" name="edit_prefijo" required placeholder="Introduce el prefijo" #edit_prefijo="ngModel"/>
          <div *ngIf="edit_prefijo.invalid && edit_prefijo.touched" class="error">
            El prefijo es obligatorio.
          </div>
        </div>
      
        <!-- Campo: Slug -->
        <div class="campo-formulario">
          <label for="slug">Slug:</label>
          <input type="text" id="slug" [(ngModel)]="ambitoAEditar!.slug" name="edit_slug" required placeholder="Introduce el slug" #edit_slug="ngModel"/>
          <div *ngIf="edit_slug.invalid && edit_slug.touched" class="error">
            El slug es obligatorio.
          </div>
        </div>
      
        <!-- Botones del formulario -->
        <div class="botones-formulario">
          <button type="submit" class="btn-submit" [disabled]="formEditar.invalid">Guardar cambios</button>
          <button type="button" class="btn-cancelar" (click)="mostrarFormularioEditar = false">Cancelar</button>
        </div>
      </form>      
    </div>

  </div>
</div>

<!-- Modal de confirmación para eliminar un ámbito -->
<div class="modal-overlay" *ngIf="mostrarModal">
  <div class="modal-container">
    <div class="modal-header">
      <h2>Confirmar eliminación</h2>
    </div>
    <div class="modal-body">
      <p>¿Está seguro de que desea eliminar este ámbito?</p>
      <p class="warning-text">Esta acción no se puede deshacer.</p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cancelarEliminarAmbito()">Cancelar</button>
      <button class="btn-eliminar" (click)="eliminarAmbito()">Eliminar</button>
    </div>
  </div>
</div>